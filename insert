sub insert($);

while (<>) {
    if (/^!Insert (.*)$/) {
        insert $1;
    }
    print
}

sub insert($) {
    $file = shift;
    local $fh = <F>;
    open $fh, "<", $file or die "Failed to open $file: $!";
    while (<$fh>) {
        if (/^!Insert (.*)$/) {
            insert $1;
        }
        print;
    }
    close $fh;
}
